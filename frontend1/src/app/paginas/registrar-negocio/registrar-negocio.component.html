<app-navbar></app-navbar>

<main class="mt-12 max-w-2xl mx-auto px-4 py-12">
  <ng-container *ngIf="paso === 1">
    <h2 class="text-2xl font-bold text-center mb-4">
      {{ "REGISTER_BUSINESS.STEP1_TITLE" | translate }}
    </h2>
    <p class="text-center text-gray-600 mb-6">
      {{ "REGISTER_BUSINESS.STEP1_SUBTITLE" | translate }}
    </p>

    <div class="grid grid-cols-3 gap-4 mb-4">
      <button
        *ngFor="let item of especializaciones.slice(0, 3)"
        (click)="seleccionarTipo(item.valor)"
        class="flex flex-col items-center p-4 bg-white rounded-lg shadow hover:shadow-md transition"
        type="button"
      >
        <img
          [src]="item.imagen"
          [alt]="item.labelKey | translate"
          class="w-16 h-16 rounded-full mb-2 object-cover"
        />
        <span class="text-sm font-medium text-center">
          {{ item.labelKey | translate }}
        </span>
      </button>
    </div>

    <div class="flex justify-center gap-4">
      <button
        *ngFor="let item of especializaciones.slice(3, 5)"
        (click)="seleccionarTipo(item.valor)"
        class="flex flex-col items-center p-4 bg-white rounded-lg shadow hover:shadow-md transition w-1/3"
        type="button"
      >
        <img
          [src]="item.imagen"
          [alt]="item.labelKey | translate"
          class="w-16 h-16 rounded-full mb-2 object-cover"
        />
        <span class="text-sm font-medium text-center">
          {{ item.labelKey | translate }}
        </span>
      </button>
    </div>
  </ng-container>

  <ng-container *ngIf="paso === 2">
    <div class="max-w-2xl mx-auto bg-white shadow-lg rounded-2xl p-6 sm:p-8">
      <h2 class="text-3xl font-semibold text-center text-gray-800 mb-8">
        {{ "REGISTER_BUSINESS.STEP2_TITLE" | translate }}
      </h2>

      <form
        #registroForm="ngForm"
        (ngSubmit)="registrarSalon()"
        novalidate
        class="space-y-6"
      >
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Nombre del salón -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ "REGISTER_BUSINESS.FIELD_NAME" | translate }}
              <span class="text-red-500">*</span>
            </label>
            <input
              name="nombre"
              [(ngModel)]="datosNegocio.nombre"
              #nombre="ngModel"
              required
              minlength="3"
              placeholder="{{ 'REGISTER_BUSINESS.PLACEHOLDER_NAME' | translate }}"
              class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#117b95] focus:outline-none"
              [ngClass]="{
                'border-red-500': nombre.invalid && nombre.touched,
                'border-green-400': nombre.valid && nombre.touched
              }"
            />
            <div *ngIf="nombre.touched && nombre.invalid" class="text-red-600 mt-1 text-sm">
              <div *ngIf="nombre.errors?.['required']">
                {{ "REGISTER_BUSINESS.ERROR_REQUIRED_FIELD" | translate }}
              </div>
              <div *ngIf="nombre.errors?.['minlength']">
                {{ "REGISTER_BUSINESS.ERROR_MIN_LENGTH" | translate:{ min: 3 } }}
              </div>
            </div>
          </div>

          <!-- Dirección -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ "REGISTER_BUSINESS.FIELD_ADDRESS" | translate }}
              <span class="text-red-500">*</span>
            </label>
            <input
              name="direccion"
              [(ngModel)]="datosNegocio.direccion"
              #direccion="ngModel"
              required
              placeholder="{{ 'REGISTER_BUSINESS.PLACEHOLDER_ADDRESS' | translate }}"
              class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#117b95] focus:outline-none"
              [ngClass]="{
                'border-red-500': direccion.invalid && direccion.touched,
                'border-green-400': direccion.valid && direccion.touched
              }"
            />
            <div *ngIf="direccion.touched && direccion.invalid" class="text-red-600 mt-1 text-sm">
              <div *ngIf="direccion.errors?.['required']">
                {{ "REGISTER_BUSINESS.ERROR_REQUIRED_FIELD" | translate }}
              </div>
            </div>
          </div>

          <!-- CIF -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ "REGISTER_BUSINESS.FIELD_CIF" | translate }}
              <span class="text-red-500">*</span>
            </label>
            <input
              name="cif"
              [(ngModel)]="datosNegocio.cif"
              #cif="ngModel"
              required
              pattern="[A-Za-z]\d{7}[A-Za-z0-9]"
              placeholder="{{ 'REGISTER_BUSINESS.PLACEHOLDER_CIF' | translate }}"
              class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#117b95] focus:outline-none"
              [ngClass]="{
                'border-red-500': cif.invalid && cif.touched,
                'border-green-400': cif.valid && cif.touched
              }"
            />
            <div *ngIf="cif.touched && cif.invalid" class="text-red-600 mt-1 text-sm">
              <div *ngIf="cif.errors?.['required']">
                {{ "REGISTER_BUSINESS.ERROR_REQUIRED_FIELD" | translate }}
              </div>
              <div *ngIf="cif.errors?.['pattern']">
                {{ "REGISTER_BUSINESS.ERROR_CIF_PATTERN" | translate }}
              </div>
            </div>
          </div>

          <!-- Teléfono -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ "REGISTER_BUSINESS.FIELD_PHONE" | translate }}
              <span class="text-red-500">*</span>
            </label>
            <input
              name="telefono"
              [(ngModel)]="datosNegocio.telefono"
              #telefono="ngModel"
              required
              pattern="^[0-9]{9}$"
              placeholder="{{ 'REGISTER_BUSINESS.PLACEHOLDER_PHONE' | translate }}"
              class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#117b95] focus:outline-none"
              [ngClass]="{
                'border-red-500': telefono.invalid && telefono.touched,
                'border-green-400': telefono.valid && telefono.touched
              }"
            />
            <div *ngIf="telefono.touched && telefono.invalid" class="text-red-600 mt-1 text-sm">
              <div *ngIf="telefono.errors?.['required']">
                {{ "REGISTER_BUSINESS.ERROR_REQUIRED_FIELD" | translate }}
              </div>
              <div *ngIf="telefono.errors?.['pattern']">
                {{ "REGISTER_BUSINESS.ERROR_PHONE_PATTERN" | translate }}
              </div>
            </div>
          </div>

          <!-- Email (ocupa 2 columnas) -->
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ "REGISTER_BUSINESS.FIELD_EMAIL" | translate }}
              <span class="text-red-500">*</span>
            </label>
            <input
              name="email"
              type="email"
              [(ngModel)]="datosNegocio.email"
              #email="ngModel"
              required
              placeholder="{{ 'REGISTER_BUSINESS.PLACEHOLDER_EMAIL' | translate }}"
              class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#117b95] focus:outline-none"
              [ngClass]="{
                'border-red-500': email.invalid && email.touched,
                'border-green-400': email.valid && email.touched
              }"
            />
            <div *ngIf="email.touched && email.invalid" class="text-red-600 mt-1 text-sm">
              <div *ngIf="email.errors?.['required']">
                {{ "REGISTER_BUSINESS.ERROR_REQUIRED_FIELD" | translate }}
              </div>
              <div *ngIf="email.errors?.['email']">
                {{ "REGISTER_BUSINESS.ERROR_EMAIL_INVALID" | translate }}
              </div>
            </div>
          </div>

          <!-- Descripción (opcional) -->
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ "REGISTER_BUSINESS.FIELD_DESCRIPTION" | translate }}
            </label>
            <textarea
              name="descripcion"
              [(ngModel)]="datosNegocio.descripcion"
              placeholder="{{ 'REGISTER_BUSINESS.PLACEHOLDER_DESCRIPTION' | translate }}"
              rows="3"
              class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#117b95] focus:outline-none resize-none"
            ></textarea>
          </div>

          <!-- Horarios -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ "REGISTER_BUSINESS.FIELD_OPEN" | translate }}
              <span class="text-red-500">*</span>
            </label>
            <input
              name="horario_apertura"
              type="time"
              [(ngModel)]="datosNegocio.horario_apertura"
              #horarioA="ngModel"
              required
              class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#117b95] focus:outline-none"
              [ngClass]="{
                'border-red-500': horarioA.invalid && horarioA.touched,
                'border-green-400': horarioA.valid && horarioA.touched
              }"
            />
            <div *ngIf="horarioA.touched && horarioA.invalid" class="text-red-600 mt-1 text-sm">
              <div *ngIf="horarioA.errors?.['required']">
                {{ "REGISTER_BUSINESS.ERROR_REQUIRED_FIELD" | translate }}
              </div>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ "REGISTER_BUSINESS.FIELD_CLOSE" | translate }}
              <span class="text-red-500">*</span>
            </label>
            <input
              name="horario_cierre"
              type="time"
              [(ngModel)]="datosNegocio.horario_cierre"
              #horarioC="ngModel"
              required
              class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#117b95] focus:outline-none"
              [ngClass]="{
                'border-red-500': horarioC.invalid && horarioC.touched,
                'border-green-400': horarioC.valid && horarioC.touched
              }"
            />
            <div *ngIf="horarioC.touched && horarioC.invalid" class="text-red-600 mt-1 text-sm">
              <div *ngIf="horarioC.errors?.['required']">
                {{ "REGISTER_BUSINESS.ERROR_REQUIRED_FIELD" | translate }}
              </div>
            </div>
          </div>
        </div>

        <!-- Upload de foto -->
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">
            {{ "REGISTER_BUSINESS.FIELD_PHOTO" | translate }}
          </label>

          <label
            class="inline-flex items-center px-4 py-2 bg-[#117b95] text-white rounded-lg cursor-pointer hover:bg-[#0e6378] transition"
          >
            <span class="mr-2 text-lg">📸</span>
            <span>{{ "REGISTER_BUSINESS.BUTTON_SELECT_FILE" | translate }}</span>

            <input
              type="file"
              name="foto"
              accept="image/*"
              (change)="onFileChange($event)"
              class="hidden"
            />
          </label>

          <div *ngIf="imagenPreview" class="mt-4">
            <p class="text-sm text-gray-500 mb-2">
              {{ "REGISTER_BUSINESS.LABEL_PREVIEW" | translate }}
            </p>
            <img
              [src]="imagenPreview"
              alt="{{ 'REGISTER_BUSINESS.LABEL_PREVIEW' | translate }}"
              class="w-full max-h-64 object-cover rounded-lg shadow-sm"
            />
          </div>
        </div>

        <!-- Botón y mensajes -->
        <div class="space-y-3">
          <button
            type="submit"
            [disabled]="registroForm.invalid || cargando"
            class="w-full py-3 rounded-lg text-white bg-[#117b95] hover:bg-[#0e6378] transition disabled:opacity-50"
          >
            {{
              cargando
                ? ("REGISTER_BUSINESS.BUTTON_SUBMIT_LOADING" | translate)
                : ("REGISTER_BUSINESS.BUTTON_SUBMIT" | translate)
            }}
          </button>
          <p *ngIf="mensajeExitoKey" class="text-center text-green-600 font-medium">
            {{ mensajeExitoKey | translate }}
          </p>
          <p *ngIf="mensajeErrorKey" class="text-center text-red-600 font-medium">
            {{ mensajeErrorKey | translate : mensajeErrorParams }}
          </p>
        </div>
      </form>
    </div>
  </ng-container>
</main>

<app-footer></app-footer>
